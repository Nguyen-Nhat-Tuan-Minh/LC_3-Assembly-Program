.ORIG x3000

LD R2, INIT
LD R3, COUNTER
AND R5, R5, #0
AND R6, R6, #0
JSR SORT
JSR SORT_UP
JSR SORT_FINAL

DONE
HALT

SAVER7 .FILL #0
INIT .FILL x3100
NEWSTO .FILL x3200
COUNTER .FILL #20
NEWSTO_PTR .FILL x3300
NEWARRAY_COUNT .FILL x3400
SPACE .FILL x-100

SORT
ST R7, SAVER7

SORT_LOOP
LDR R0, R2, #0
LDR R1, R2, #1
NOT R4, R1
ADD R4, R4, #1 ; R4 = -R1
ADD R4, R4, R0 ; R4 = R0 - R1
BRp BREAK

LD R0, NEWSTO_PTR
ADD R0, R0, R6
STR R2, R0, #0

LD R0, NEWARRAY_COUNT
ADD R0, R0, R6
ADD R5, R5, #1
STR R5, R0, #0
ADD R6, R6, #1
BR UPDATE 

BREAK
AND R5, R5, #0 
 
UPDATE
ADD R2, R2, #1
ADD R3, R3, #-1
BRp SORT_LOOP

LD R7, SAVER7
RET

SORT_UP
ST R7, SAVER7

LD R1, NEWARRAY_COUNT
AND R6, R6, #0
ADD R6, R6, #10
LDR R5, R1, #0
ADD R0, R1, #0

UP_LOOP
LDR R2, R1, #0
NOT R4, R2
ADD R4, R4, #1 ; R4 = -R2
ADD R4, R4, R5 ; R4 = R5 - R2
BRzp UPDATE_N

ADD R5, R2, #0
ADD R0, R1, #0

UPDATE_N
ADD R1, R1, #1
ADD R6, R6, #-1
BRp UP_LOOP

LD R6, SPACE
ADD R0, R0, R6
ADD R5, R5, #1
LDR R4, R0, #0
ADD R4, R4, #1 

LD R7, SAVER7
RET

SORT_FINAL
ST R7, SAVER7
LD R2, NEWSTO

STORE_LOOP
LDR R1, R4, #0
STR R1, R2, #0

ADD R2, R2, #1
ADD R4, R4, #-1
ADD R5, R5, #-1
BRp STORE_LOOP
 
LD R7, SAVER7
RET

.END